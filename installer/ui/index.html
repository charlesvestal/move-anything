<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move Everything Installer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Warning Screen -->
        <div id="screen-warning" class="screen active">
            <h1>‚ö†Ô∏è Important Information</h1>
            <div class="warning-box">
                <p><strong>Are you sure you want to install Move Everything on your Ableton Move?</strong></p>
                <p>This software is <strong>community-developed</strong> and not officially supported by Ableton.</p>
                <p>The installation is designed to be safe and reversible. The authors accept no liability for issues, but countless users have installed Move Everything with no reports of permanent damage or bricking a device.</p>
                <p><strong>Note:</strong> Installation works best when your Move is connected via <strong>WiFi</strong>, not USB-C. Ensure your Move is connected to the same network as this computer.</p>
            </div>
            <div class="action-buttons">
                <button id="btn-cancel" class="secondary">Cancel</button>
                <button id="btn-accept-warning">I Understand, Continue</button>
            </div>
        </div>

        <!-- Device Discovery Screen -->
        <div id="screen-discovery" class="screen">
            <h1>Move Everything Installer</h1>
            <div id="discovery-status">
                <div class="spinner"></div>
                <p id="status-text">Searching for your Ableton Move...</p>
            </div>
            <div id="device-list"></div>
            <div class="manual-entry" style="display: none;">
                <p>Can't find move.local? Enter IP address:</p>
                <input type="text" id="manual-ip" placeholder="e.g., 192.168.1.100">
                <button id="btn-manual-connect">Connect</button>
            </div>
            <button id="btn-cancel-discovery" class="secondary">Cancel</button>
        </div>

        <!-- Code Entry Screen -->
        <div id="screen-code-entry" class="screen">
            <h1>Enter Authorization Code</h1>
            <p class="instruction">Check your Ableton Move display for a 6-digit code</p>
            <div class="code-input">
                <input type="text" id="code-digit-1" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-2" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-3" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-4" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-5" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-6" maxlength="1" class="code-digit">
            </div>
            <button id="btn-submit-code" disabled>Continue</button>
            <button id="btn-back-discovery" class="secondary">Back</button>
        </div>

        <!-- SSH Key Setup Screen -->
        <div id="screen-ssh-key" class="screen">
            <h1>Secure Connection Setup</h1>
            <p class="instruction" id="ssh-key-message"></p>
            <div class="info-box" id="ssh-key-explanation" style="display: none;">
                <p><strong>What is this?</strong></p>
                <p>A secure connection key lets the installer communicate safely with your Move device. This key will only be used for Move Everything installation and won't affect other systems.</p>
            </div>
            <div class="action-buttons">
                <button id="btn-back-ssh-key" class="secondary">Back</button>
                <button id="btn-add-ssh-key">Add Key to Move</button>
            </div>
        </div>

        <!-- Confirm on Device Screen -->
        <div id="screen-confirm" class="screen">
            <h1>Confirm on Device</h1>
            <div class="spinner"></div>
            <p class="instruction">On your Ableton Move, use the jog wheel to select "Yes" and press to confirm</p>
            <p class="instruction" style="font-size: 0.9rem; margin-top: 1rem;">Waiting for confirmation...</p>
            <button id="btn-cancel-confirm" class="secondary">Cancel</button>
        </div>

        <!-- Loading Screen (used for version checks and other loading states) -->
        <div id="screen-version-check" class="screen">
            <h1>Please Wait</h1>
            <div id="version-check-status">
                <div class="spinner"></div>
                <p class="instruction">Loading...</p>
            </div>
        </div>

        <!-- Management Screen (for existing installations) -->
        <div id="screen-management" class="screen">
            <h1>Manage Move Everything</h1>
            <p class="instruction">Move Everything is installed on your device. What would you like to do?</p>

            <div class="install-options">
                <div class="radio-group">
                    <div class="radio-option" id="option-manage-modules" style="cursor: pointer;">
                        <div class="option-content">
                            <strong>Install New Modules</strong>
                            <span>Add modules to your installation (selecting installed modules will reinstall them)</span>
                        </div>
                    </div>

                    <div class="radio-option" id="option-upgrade-core" style="cursor: pointer; display: none;">
                        <div class="option-content">
                            <strong>Upgrade Core</strong>
                            <span id="upgrade-core-description">Update to the latest version</span>
                        </div>
                    </div>

                    <div class="radio-option" id="option-toggle-screenreader" style="cursor: pointer;">
                        <div class="option-content">
                            <strong>Screen Reader</strong>
                            <span id="screenreader-status">Enable or disable text-to-speech accessibility</span>
                        </div>
                    </div>

                    <div class="radio-option" id="option-uninstall" style="cursor: pointer;">
                        <div class="option-content">
                            <strong>Uninstall Move Everything</strong>
                            <span>Remove all files and restore stock Move firmware</span>
                        </div>
                    </div>
                </div>
            </div>

            <button id="btn-back-management" class="secondary">Back</button>
        </div>

        <!-- Module Selection Screen -->
        <div id="screen-modules" class="screen">
            <h1>Installation Options</h1>

            <div class="install-options">
                <h3>Installation Type</h3>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="complete" checked>
                        <div class="option-content">
                            <strong>Complete</strong>
                            <span>All modules with full UI (recommended)</span>
                            <p class="option-detail">Installs Signal Chain, synths, effects, and all UI features. Best for most users.</p>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="custom">
                        <div class="option-content">
                            <strong>Custom</strong>
                            <span>Choose specific modules</span>
                            <p class="option-detail">Select only the modules you want. Saves space if you don't need everything.</p>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="core">
                        <div class="option-content">
                            <strong>Core Only</strong>
                            <span>Framework and UI, no modules</span>
                            <p class="option-detail">Minimal installation. Add modules later via Module Store. Good for testing.</p>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="screenreader">
                        <div class="option-content">
                            <strong>Screen Reader Only</strong>
                            <span>Audio interface with text-to-speech</span>
                            <p class="option-detail">For visually impaired users. No visual display. All navigation via voice prompts.</p>
                        </div>
                    </label>
                </div>

                <h3>Accessibility</h3>
                <label class="checkbox-option">
                    <input type="checkbox" id="enable-screenreader">
                    <span>Enable screen reader (text-to-speech)</span>
                </label>
            </div>

            <div id="module-categories" style="display: none;"></div>

            <div class="action-buttons">
                <button id="btn-install">Install</button>
                <button id="btn-back-modules" class="secondary">Back</button>
            </div>
        </div>

        <!-- Installing Screen -->
        <div id="screen-installing" class="screen">
            <h1>Installing Move Everything</h1>
            <div class="progress-container">
                <div id="install-progress" class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <p id="install-status">Preparing installation...</p>
            </div>
            <div id="install-checklist"></div>
        </div>

        <!-- Success Screen -->
        <div id="screen-success" class="screen">
            <h1>You're All Set! üéâ</h1>
            <div class="success-icon">‚úì</div>
            <p class="instruction">Move Everything has been successfully installed on your device.</p>
            <div class="info-box">
                <p><strong>Next Steps:</strong></p>
                <ol style="margin: 0.5rem 0 0 1.5rem; color: #b8b8b8;">
                    <li style="margin: 0.5rem 0;">Restart your Ableton Move to load Move Everything</li>
                    <li style="margin: 0.5rem 0;">Press <strong style="color: #0066cc;">Shift + Vol + Knob 1</strong> to toggle shadow mode</li>
                    <li style="margin: 0.5rem 0;">Explore the built-in modules and Signal Chain</li>
                </ol>
            </div>
            <button id="btn-done">Done</button>
        </div>

        <!-- Error Screen -->
        <div id="screen-error" class="screen">
            <h1>Installation Failed</h1>
            <div class="error-icon">‚úó</div>
            <div id="error-message"></div>
            <button id="btn-retry">Try Again</button>
            <button id="btn-diagnostics" class="secondary">Copy Diagnostics</button>
        </div>
    </div>

    <script>
        // Debug logging
        console.log('[DEBUG] Inline JavaScript is executing');
        console.log('[DEBUG] Window location:', window.location.href);

        document.addEventListener('DOMContentLoaded', () => {
            console.log('[DEBUG] DOM loaded');
        });
    </script>
    <script src="./app.js"></script>
    <script>
        console.log('[DEBUG] After app.js script tag');
    </script>
</body>
</html>
