<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move Everything Installer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Warning Screen -->
        <div id="screen-warning" class="screen active">
            <h1>⚠️ Warning</h1>
            <div class="warning-box">
                <p><strong>Are you sure you want to install Move Everything on your Ableton Move?</strong></p>
                <p>This is <strong>UNSUPPORTED</strong> by Ableton.</p>
                <p>The authors of this project accept no liability for any damage you incur by proceeding.</p>
            </div>
            <button id="btn-accept-warning">I Understand, Continue</button>
            <button id="btn-cancel" class="secondary">Cancel</button>
        </div>

        <!-- Device Discovery Screen -->
        <div id="screen-discovery" class="screen">
            <h1>Move Everything Installer</h1>
            <div id="discovery-status">
                <div class="spinner"></div>
                <p id="status-text">Searching for your Ableton Move...</p>
            </div>
            <div id="device-list"></div>
            <div class="manual-entry" style="display: none;">
                <p>Can't find move.local? Enter IP address:</p>
                <input type="text" id="manual-ip" placeholder="e.g., 192.168.1.100">
                <button id="btn-manual-connect">Connect</button>
            </div>
        </div>

        <!-- Code Entry Screen -->
        <div id="screen-code-entry" class="screen">
            <h1>Enter Authorization Code</h1>
            <p class="instruction">Check your Ableton Move display for a 6-digit code</p>
            <div class="code-input">
                <input type="text" id="code-digit-1" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-2" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-3" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-4" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-5" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-6" maxlength="1" class="code-digit">
            </div>
            <button id="btn-submit-code" disabled>Continue</button>
            <button id="btn-back-discovery" class="secondary">Back</button>
        </div>

        <!-- SSH Key Setup Screen -->
        <div id="screen-ssh-key" class="screen">
            <h1>SSH Key Setup</h1>
            <p class="instruction" id="ssh-key-message"></p>
            <button id="btn-add-ssh-key">Add SSH Key to Move</button>
            <button id="btn-back-ssh-key" class="secondary">Back</button>
        </div>

        <!-- Confirm on Device Screen -->
        <div id="screen-confirm" class="screen">
            <h1>Confirm on Device</h1>
            <div class="spinner"></div>
            <p class="instruction">On your Ableton Move, use the jog wheel to select "Yes" and press to confirm</p>
            <button id="btn-cancel-confirm" class="secondary">Cancel</button>
        </div>

        <!-- Module Selection Screen -->
        <div id="screen-modules" class="screen">
            <h1>Installation Options</h1>

            <div class="install-options">
                <h3>Installation Type</h3>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="complete" checked>
                        <div class="option-content">
                            <strong>Complete</strong>
                            <span>All modules with full UI (recommended)</span>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="custom">
                        <div class="option-content">
                            <strong>Custom</strong>
                            <span>Choose specific modules</span>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="core">
                        <div class="option-content">
                            <strong>Core Only</strong>
                            <span>No modules, full UI</span>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="screenreader">
                        <div class="option-content">
                            <strong>Screen Reader Only</strong>
                            <span>Audio interface, no graphical UI</span>
                        </div>
                    </label>
                </div>

                <h3>Accessibility</h3>
                <label class="checkbox-option">
                    <input type="checkbox" id="enable-screenreader">
                    <span>Enable screen reader (text-to-speech)</span>
                </label>
            </div>

            <div id="module-categories" style="display: none;"></div>

            <div class="action-buttons">
                <button id="btn-install">Install</button>
                <button id="btn-back-modules" class="secondary">Back</button>
            </div>
        </div>

        <!-- Installing Screen -->
        <div id="screen-installing" class="screen">
            <h1>Installing Move Everything</h1>
            <div class="progress-container">
                <div id="install-progress" class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <p id="install-status">Preparing installation...</p>
            </div>
            <div id="install-log"></div>
        </div>

        <!-- Success Screen -->
        <div id="screen-success" class="screen">
            <h1>Installation Complete!</h1>
            <div class="success-icon">✓</div>
            <p class="instruction">Move Everything has been successfully installed on your device</p>
            <button id="btn-done">Done</button>
        </div>

        <!-- Error Screen -->
        <div id="screen-error" class="screen">
            <h1>Installation Failed</h1>
            <div class="error-icon">✗</div>
            <div id="error-message"></div>
            <button id="btn-retry">Try Again</button>
            <button id="btn-diagnostics" class="secondary">Copy Diagnostics</button>
        </div>
    </div>

    <script>
        // Use Tauri's internal IPC directly (works in packaged apps)
        window.__TAURI__ = {
            invoke: async (cmd, args) => {
                return window.__TAURI_INTERNALS__.invoke(cmd, args);
            }
        };

        // Debug: Test if inline JS works
        console.log('[DEBUG] Inline JavaScript is executing');
        console.log('[DEBUG] Window location:', window.location.href);

        // Try to change text to verify DOM access
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[DEBUG] DOM loaded');
            const statusEl = document.getElementById('status-text');
            if (statusEl) {
                console.log('[DEBUG] Found status-text element');
                statusEl.textContent = 'Testing inline JS...';
            } else {
                console.error('[DEBUG] Could not find status-text element');
            }
        });
    </script>
    <script src="./app.js"></script>
    <script>
        console.log('[DEBUG] After app.js script tag');
    </script>
</body>
</html>
